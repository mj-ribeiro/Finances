---
title: "Analyzing Financial and Economic Data with R"
subtitle: "Chapter 01 - Introduction"
author: "Marcelo S. Perlin"
date: "2020-02-15"
output:
slidy_presentation: default
ioslides_presentation: default
beamer_presentation: default
---
## Introduction {#introduction}
**In the digital era, information is abundant and accessible**.
- Datasets related to Economics and Finance are widely available to the public.
- The job market expects that a graduate student or a data analyst has learned at least one programming language that allows him/her to do his work efficiently.
In this setup, the role and contribution of R **shine**.
## What is R
**R is a programming language specially designed to resolve statistical problems and display graphical representations of data. **
- Today, R is almost synonymous with data analysis, with a large user base and consolidated modules.
- On the business side, large and established companies, such as _Google_ and _Microsoft_, already adopted R as the internal language for data analysis. R is maintained by [**R Foundation**](https://www.r-project.org/foundation/) and the [**R Consortium**](https://www.r-consortium.org/), a collective effort to fund projects for extending the programming language. \index{R foundation} \index{R consortium}
## Why Choose R
- **R is a mature and stable platform, continuously supported and intensively used in the industry**.
- **Learning R is easy**.
- **The engine of R and the interface of RStudio creates a highly productive environment**.
- **CRAN Packages allow the user to do many different things with R**.
- **R is compatible with different operating systems and it can interface with different programming languages**.
- **R is free!**
## What Can You Do With R and RStudio?
- Substitute and improve data-intensive tasks from spreadsheet-like software;
- Develop routines for managing and controlling investment portfolios and executing financial orders;
- Creating tools for calculating and reporting economic indices such as inflation and unemployment;
- Performing empirical data research using statistical techniques, such as econometric models and hypothesis testing;
- Create dynamic _websites_ with the `shiny` package, allowing anyone in the world to use a computational tool created by you; \index{shiny}
- Automate the process of writing technical reports with the **RMarkdown** technology; \index{RMarkdown}
## Installing R {#installing}
The most direct and practical way to install R is to direct your browser to [R website](http://www.r-project.org/) and click the _Download_ link in the left side of the page, as shown in Figure \@ref(fig:website-cran-1).
```{r website-cran-1,  out.width = '100%', echo=FALSE, purl=FALSE, fig.cap= 'Initial page for downloading R' }
knitr::include_graphics('figs/website_cran_1.png')
```
The next screen gives you a choice of the mirror to download the installation files. The CRAN repository (_R Comprehensive Archive network_) is mirrored in various parts of the world. You can choose one of the links from the nearest location to you. If undecided, just select the mirror _0-Cloud_ (see Figure \@ref(fig:website-cran-2)), which will automatically take you to the nearest location.
```{r website-cran-2, out.width = '100%', echo=FALSE, , purl=FALSE, fig.cap= 'Choosing the CRAN mirror'}
knitr::include_graphics('figs/website_cran_2.png')
```
The next step involves selecting your operating system, likely to be  _Windows_.
```{r website-cran-3,  out.width = '100%', purl=FALSE, echo=FALSE, purl=FALSE, fig.cap= 'Choosing the operating system'}
knitr::include_graphics('figs/website_cran_3.png')
```
After clicking the link _Download R for Windows_, as in Figure \@ref(fig:website-cran-3), the next screen will show the following download options: _base_, _contrib_, _old.contrib_ and _RTools_. The first (_base_), should be selected.
```{r website-cran-4,  out.width = '100%', purl=FALSE, echo=FALSE, purl=FALSE, fig.cap= 'Installation options'}
knitr::include_graphics('figs/website_cran_4.png')
```
After clicking the link _base_, the next screen will show the link to the _download_ of the R installation file (Figure \@ref(fig:website-cran-5)). After downloading the file, open it and follow the steps in the installation screen. At this time, no special configuration is required. I suggest keeping all the default choices and simply hit _accept_ in the displayed dialogue screens. After the installation of R, it is strongly recommended to install RStudio, which will be addressed next.
```{r website-cran-5,  out.width = '100%',  purl=FALSE, echo=FALSE, purl=FALSE, fig.cap= 'Downloading R'}
knitr::include_graphics('figs/website_cran_5.png')
```
## Installing RStudio
The base installation of R includes its own _GUI_ (graphical user interface), where we can write and execute code. However, this native interface has several limitations. RStudio substitutes the original GUI and makes access to R more practical and efficient.
The installation of RStudio is simpler than that of R. The files are available in [RStudio website](https://www.rstudio.com/). After accessing the page, click _Download RStudio_ and then _Download RStudio Desktop_. After that, just select the installation file relative to the operating system on which you will work. This option is probably _WINDOWS Vista 7/8/10_.
## Resources in the Web
**The R community is vivid and engaging**.
- [R-Bloggers](https://www.r-bloggers.com/) is a website that aggregates R blogs, making it easier for anyone to access and participate. I strongly recommend to sign up for the R-Bloggers feed in [RSS](https://feeds.feedburner.com/RBloggers)^[https://feeds.feedburner.com/RBloggers], [Facebook](https://www.facebook.com/rbloggers/?fref=ts)^[https://www.facebook.com/rbloggers/?fref=ts] or [Twitter](https://twitter.com/Rbloggers)^[https://twitter.com/Rbloggers]. Not only you'll be informed of what is happening in the R community, but also learn a lot by reading other people's code and articles. \index{RBloggers}
- Several conferences and user-groups are available in many countries. You can find the complete list in this [link](https://jumpingrivers.github.io/meetingsR/index.html).
## Structure and Organization
Throughout the slides, every demonstration of code will have two parts: the R code and its output. The output is nothing more than the result of the commands on the screen. All inputs and outputs code will be marked in the text with a special format. See the following example:
```{r}
# create a list
L <- list('abc', 1:5, 'dec')
# print list
print(L)
```
For the previous chunk of code, lines `L <- list('abc', 1:5, 'dec')` and `print(L)` are actual commands given to R. The output of this simple piece of code is the on-screen presentation of the contents of object `L`. The symbol `R> ` is used for any code output. Notice also that inline comments are set with the symbol `#`. Anything on the right side of `#` is not evaluated by R. These comments serve as written notes about the code.
The code can also be spatially organized using newlines. This is a common strategy around arguments of functions. The next chunk of code is equivalent to the previous and will run the exact same way. Notice how we used a new line to vertically align the arguments of function `list`. You'll soon see that, throughout the book, this type of vertical alignment is constantly used.
```{r}
# create a list
L <- list('abc',
1:5,
'dec')
# print list
print(L)
```
## Exercises
01. Use [Google](https://www.google.com/search?q=R+groups+in+my+city) to search for R groups in your region. Verify if there are frequent meetings and, if you so desire, go to one and make new friends.
02. Once you have R and RStudio installed, head over to the [CRAN package website](https://cloud.r-project.org/web/packages/available_packages_by_date.html)^[https://cloud.r-project.org/web/packages/available_packages_by_date.html] and search for computer technologies that you use in your current work. For example, if you use [Google Sheets](https://www.google.com/sheets/about/)^[https://www.google.com/sheets/about/] extensively in your work, you'll soon find there is a package in CRAN that can interact with it by creating and reading cloud-based spreadsheets.
03. If you work in an institution with data infrastructure, talk to the IT department and seek to understand what type of data technology is being currently used. Check if it's possible, from R, to connect to the databases of your company and import the tables. No need for writing any code yet, just make sure the technology is available.
04. Head over to the [RBloggers](https://www.r-bloggers.com/)^[https://www.r-bloggers.com/] website and search for a topic of your interest, such as, "Tennis" or "investments". Read at least two or three articles that interest you.
%>%
x %>%
x %>%
y
x %>% rnorm(10)
install.packages("magrittr")
library(magrittr)
x %>% rnorm(10)
x = rnorm(10)
x %>% sum
x %>% sum %>% sqrt
x %>% sum %>% sqrt %>% plot
setwd("D:/Git projects/R course")
x = rnorm(100)
xpos = x[x>0]
xpos %>% mean
med = xpos %>% mean
xpos = x %>% x>0
xpos = x %>% [x>0]
x%>% plot
x%>% plot(type='l')
library(moments)
mom = function(z){
skewness = skewness(z)
kurtosis = kurtosis(z)
mean = mean(z)
sd = sd(z)
plot(z, type='l')
}
x %>% mom
mom = function(z){
sk = skewness(z)
ku = kurtosis(z)
m = mean(z)
sd = sd(z)
res = data.frame(sk, ku, m, sd)
return(res)
}
x %>% mom
mom = function(z){
skewness = skewness(z)
kurtosis = kurtosis(z)
mean = mean(z)
sd = sd(z)
res = data.frame(skewness, kurtosis, mean, sd)
return(res)
}
x %>% mom
mom = function(z){
skewness = skewness(z)
kurtosis = kurtosis(z)
mean = mean(z)
sd = sd(z)
res = data.frame(skewness, kurtosis, mean, sd)
return(res)
return(plot(z))
}
x %>% mom
x %>% mom
p = function(z){
return(plot(z))
}
x %>% p
return(plot(z, type='l'))
p = function(z){
return(plot(z, type='l'))
}
x %>% p
quantile(x,0.05)
var = quantile(x, 0.05)
es = x[x<var] %>% mean
var = x %>% quantile(0.05)
e_s = c()
for (i in 1:100) {
x = rnorm(1000)
var = x %>% quantile(0.05)
es = x[x<var] %>% mean
e_s[i] = es
}
e_s %>% plot
e_s %>% plot(type='l')
library(sn)
e_s = c()
for (i in 1:100) {
x = rsn(1000, alpha = 0.5)
var = x %>% quantile(0.05)
es = x[x<var] %>% mean
e_s[i] = es
}
e_s %>% plot(type='l')
e_s %>% hist
e_s = c()
for (i in 1:1000) {
x = rsn(10000, alpha = 0.5)
var = x %>% quantile(0.05)
es = x[x<var] %>% mean
e_s[i] = es
}
e_s %>% hist
e_s %>% hist(col='lightgreen')
x = rnorm(100)
library(moments)
mom = function(z){
skewness = z %>% skewness
kurtosis = z %>% kurtosis
mean = z %>% mean
sd = z %>% sd
res = data.frame(skewness, kurtosis, mean, sd)
return(res)
}
x %>% mom
library(magrittr)
library(moments)
mom = function(z){
skewness = z %>% skewness
kurtosis = z %>% kurtosis
mean = z %>% mean
sd = z %>% sd
res = data.frame(skewness, kurtosis, mean, sd)
return(res)
}
x %>% mom
setwd("D:/Git projects/Finance/Finance_R")
#------------- CMAX Function
# w é o tamanho da janela
# é a quantidade de janelas
# s é o vetor que vou passar a função
CMAX = function(w, n, s){
l = matrix(nrow=n,ncol = (w+1))
max = matrix(nrow=n, ncol = 1)
cmax = matrix(nrow=n, ncol = 1)
for (j in 1:n){
l[j, 1:(w+1)] = s[j:(w+j)]
max[j] = max(l[j, 1:(w+1)])
cmax[j] = l[j, (w+1)]/max(max[j])
}
return(cmax)
}
# Libraries
library(tseries)
library(timeSeries)
library(quantmod)
library(fGarch)
library(GetBCBData)
# Get data
ibov = getSymbols('^BVSP', src='yahoo',
from= '1995-01-01',
periodicity = "monthly",    # IBOV mensal
auto.assign = F)[,4]
colnames(ibov) = 'ibov'
ibov = ibov[is.na(ibov)==F]
# VIX
vix = getSymbols('^VIX', src='yahoo',
periodicity = "monthly",
from= '1995-01-01',
auto.assign = F)[,4]
colnames(vix) = 'vix'
# Oil price
oil = getSymbols('CL=F', src='yahoo',
periodicity = "monthly",
from= '1995-01-01',
auto.assign = F)[,4]
colnames(oil) = 'oil'
# Gold price
gold = getSymbols('GC=F', src='yahoo',
periodicity = "monthly",
from= '1995-01-01',
auto.assign = F)[,4]
colnames(gold) = 'gold'
# 11768 - Índice da taxa de câmbio real (INPC)
cb = gbcbd_get_series(11768, first.date= '1995-01-01',
format.data = "long", be.quiet = FALSE)[ ,1:2]
data = cb$ref.date
cb[,1]=NULL
cb = xts(cb, order.by = data)
rownames(cb) = data    # colocar a data como índice
# cdi
cdi = gbcbd_get_series(4391, first.date= '1995-01-01',
format.data = "long", be.quiet = FALSE)[ ,1:2]
data = cdi$ref.date
cdi[,1]= NULL
cdi = xts(cdi, order.by = data)
rownames(cdi) = data    # colocar a data como índice
# PTAX
ptax = getSymbols('BRL=X', src='yahoo',
from= '2000-01-01',
periodicity = "monthly",
auto.assign = F)[,4]
#-------- Descriptive stats
df = data.frame(cb[index(oil)], ibov[index(oil)], vix[index(oil)], gold[index(oil)], oil[index(oil)])
apply(df[,1:3], 2, basicStats)
ret = diff(log(ibov))
basicStats(ret)
ret = ret[is.na(ret)==F]
cm2 = CMAX(6,(length(ibov)-6), ibov )
var1 = quantile(cm2, 0.05)
hist(cm2, breaks = 35, col='lightgreen',
probability = T,
main='Histograma para o CMAX diário \n com 24 janelas')
abline(v=var1)
lim = mean(cm2)-2*sd(cm2)
cm2[cm2<lim]
sum((cm2<lim)*1)   # count
# get the data of ibov
data = index(ibov)
data1 = data[7:length(ibov)]
# transform cmax in xts object
cmts = xts(x=cm2, order.by = data1)
# Plot CMAX - 24
library(zoo)
windows()
par(mfrow=c(1,1))
plot(as.zoo(cmts), main = 'CMAX- W24', ylim=c(0.5, 1),
type='l', ylab='CMAX', xlab='Ano')
abline(h=lim)
abline(h=0.95)
text(as.Date('2008-10-10'), y=0.55, labels = 'Crise \n de 2008', cex=0.8)
text(as.Date('2020-03-10'), y=0.52, labels = 'Crise \n do COVID-19', cex=0.8)
text(as.Date('2000-03-10'), y=0.6, labels = 'Bolha da \n internet', cex=0.8)
text(as.Date('2001-12-9'), y=0.6, labels = '11 de setembro', cex=0.8)
plot(cdi)
library(tseries)
library(timeSeries)
library(fGarch)
library(quantmod)
get_data = function(x, d= "2000-01-01"){
z = getSymbols(x, src='yahoo',
from= d,
periodicity = "monthly",
auto.assign = F)[,4]
return(z)
}
ativos = c('ITUB4.SA',
'VALE3.SA',
'BBDC4.SA',
'PETR4.SA',
'B3SA3.SA',
'PETR3.SA',
'ABEV3.SA',
'BBAS3.SA',
'ITSA4.SA',
'LREN3.SA',
'JBSS3.SA',
'BBDC3.SA',
'IRBR3.SA',
'GNDI3.SA',
'MGLU3.SA',
'SUZB3.SA',
'BRFS3.SA',
'UGPA3.SA',
'RENT3.SA',
'RAIL3.SA',
'WEGE3.SA',
'BBSE3.SA',
'RADL3.SA',
'VIVT4.SA',
'EQTL3.SA',
'BRDT3.SA',
'GGBR4.SA',
'CCRO3.SA',
'SBSP3.SA',
'LAME4.SA',
'COGN3.SA',
'SULA11.SA',
'AZUL4.SA',
'SANB11.SA',
'BRML3.SA',
'EMBR3.SA',
'HAPV3.SA',
'HYPE3.SA',
'BPAC11.SA',
'NTCO3.SA',
'PCAR4.SA',
'YDUQ3.SA',
'EGIE3.SA',
'CMIG4.SA',
'VVAR3.SA',
'TIMP3.SA',
'BTOW3.SA',
'KLBN11.SA',
'ELET3.SA',
'QUAL3.SA',
'CSAN3.SA',
'TOTS3.SA',
'CIEL3.SA',
'CRFB3.SA',
'CSNA3.SA',
'FLRY3.SA',
'MULT3.SA',
'ELET6.SA',
'CYRE3.SA',
'BRAP4.SA',
'BRKM5.SA',
'TAEE11.SA',
'ENBR3.SA',
'GOAU4.SA',
'MRVE3.SA',
'CVCB3.SA',
'USIM5.SA',
'GOLL4.SA',
'IGTA3.SA',
'HGTX3.SA',
'MRFG3.SA',
'ECOR3.SA',
'SMLS3.SA')
summary(ativos)
know_data = function(z){
k= get_data(z)
s = index(k)[1]
return(s)
}
t = c()
for (i in ativos) {
print(know_data(i))
t[i] = know_data(i)
}
View(t)
t = c()
for (i in ativos) {
#  print(know_data(i))
t[i] = know_data(i)
}
View(t)
library(zoo)
out = as.Date(t)
out = sort(out)    # sort by date
out = data.frame(out)
View(out)
sort_names = rownames(out)
sort_names[1:23]  # assets that date begin in 2000-01-01
assets = sort_names[1:23]
df = data.frame(lapply(assets, get_data))
basicStats(df)
for(i in 1:length(df)){
df[ ,i] = ifelse(is.na(df[,i]),
(mean(df[,i], na.rm = T)),
df[,i] )
}
basicStats(df)
nl = sum((df[,1]>0)*1)
df = df[-nl,]
nl = sum((df[,1]>0)*1)
# calculating retunrs
ret = data.frame(matrix(nrow =(nl-1), ncol=length(assets)))
for(i in 1:length(assets)){
ret[ ,i] = diff(log(df[,i]))
}
colnames(ret) = assets
library(caret)
pca = preProcess(x= ret, method = 'pca', pcaComp = 1)
pca = predict(pca, ret)
data = seq(as.Date("2000-2-1"), as.Date("2020-4-1"), by = "month")
ret = xts(ret, order.by = data)
pca = xts(pca, order.by = data)
# Plot first component
plot(pca$V1, type='l')
View(assets)
